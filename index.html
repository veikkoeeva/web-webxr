<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <meta name="Description" content="Demo using georeferened sensor data.">
  <base href="/">
  
  <!--
  <script src="https://unpkg.com/d3@6.2.0/dist/d3.min.js"></script>
  <script src="https://unpkg.com/deck.gl@^8.3.1/dist.min.js"></script>
  <script src="https://unpkg.com/mapbox-gl@1.12.0/dist/mapbox-gl.js"></script>  
  <link rel="stylesheet" type="text/css" href="https://unpkg.com/mapbox-gl@1.12.0/dist/mapbox-gl.css">
  -->
  <!--
  <style type="text/css">
        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100%;
        }

        body {
            font-family: Helvetica, Arial, sans-serif;
            width: 100vw;
            height: 100vh;
            margin: 0;
            padding: 0
        }
    </style>
    -->
  <title>Sensor data demo</title>
</head>

<body>
<web-webxr></web-webxr>
<p>Test</p>
<!-- <div id="map"></div> -->
<script type="module" src="./out-tsc/src/web-webxr.js"></script>
<script type="module">
    /*      
    import mapboxgl from 'mapbox-gl';
    import { HexagonLayer } from '@deck.gl/aggregation-layers/dist/esm';
    import { MapboxLayer } from '@deck.gl/mapbox/dist/esm';
    //import * as mapboxgl from 'mapbox-gl';
    */
    /*
    const { MapboxLayer, HexagonLayer } = deck;
    const map = new mapboxgl.Map({
        container: 'map',
        style: 'https://api.maptiler.com/maps/84873d64-1572-4d4d-92ff-dec92410f211/style.json?key=<snip>',
        center: [24.9221687500000009, 60.1610882352941161],
        zoom: 15,
        pitch: 40.5
    });

    const PM25_DATA_URL = '<snip>';
    const DATA_URL = PM25_DATA_URL;

    const OPTIONS = ['radius', 'coverage', 'upperPercentile'];
    const COLOR_RANGE = [
        [1, 152, 189],
        [73, 227, 206],
        [216, 254, 181],
        [254, 237, 177],
        [254, 173, 84],
        [209, 55, 78]
    ];

    const LIGHT_SETTINGS = {
        lightsPosition: [-0.144528, 49.739968, 8000, -3.807751, 54.104682, 8000],
        ambientRatio: 0.4,
        diffuseRatio: 0.6,
        specularRatio: 0.2,
        lightsStrength: [0.8, 0.0, 0.8, 0.0],
        numberOfLights: 4
    };

    const reducer = arr => arr.reduce((accumulator, currentValue) => currentValue ? accumulator + Number(currentValue.val) : accumulator, 0) / arr.length;
    let hexagonLayer;
    map.on('style.load', () => {
        const csvData = d3.csv(DATA_URL);
        hexagonLayer = new MapboxLayer({
            type: HexagonLayer,
            id: 'map',
            data: csvData,
            radius: 20,
            coverage: 1,
            upperPercentile: 100,
            colorRange: COLOR_RANGE,
            elevationRange: [0, 1000],
            elevationScale: 0.5,
            getElevationValue: points => reducer(points),
            getColorValue: points => reducer(points),
            extruded: true,
            getPosition: d => [Number(d.lon), Number(d.lat)],
            lightSettings: LIGHT_SETTINGS,
            onHover: true,
            opacity: 0.5
        });

        map.addLayer(hexagonLayer, "waterway");
    });*/
</script>
</body>

</html>
